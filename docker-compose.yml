version: '3.7'
volumes:
    logs:
        driver: local
services:
    slim:
        image: php:7-alpine
        working_dir: /var/www
        command: php -S 0.0.0.0:8080 -t public
        environment:
            docker: "true"
        ports:
            - 8080:8080
        volumes:
            - .:/var/www
            - logs:/var/www/logs
    slim-php-fpm:
        container_name: slim_php_fpm
        build:
            context: docker
            dockerfile: /php-fpm/Dockerfile
            cache_from:
                - ${REGISTRY:-localhost}/slim-php-fpm
        volumes:
            - ./:/app
        links:
            - slim-database
    slim-php-cli:
        container_name: slim_php_cli
        build:
            context: docker
            dockerfile: /php-cli/Dockerfile
            cache_from:
                - ${REGISTRY:-localhost}/slim-php-cli
        volumes:
            - ./:/app
        links:
            - slim-database
    slim-database:
        container_name: slim_postgres
        image: postgres:13.1-alpine
        environment:
            POSTGRES_USER: root
            POSTGRES_PASSWORD: 12345
            POSTGRES_DB: test
        volumes:
            - slim-database:/var/lib/postgresql/data
        ports:
            - "54321:5432"